(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function e(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(t){if(t.ep)return;t.ep=!0;const r=e(t);fetch(t.href,r)}})();const V={parse(s,n="VCARD"){const e=s.split(/\r\n|\r|\n/),o=[],t=[];let r=!1;for(const a of e){const[l,i]=a.split(":");if(r||l&&i){if(l==="BEGIN"){const c={};if(i===n)o.push(c),t.push(c);else if(t.at(-1)){if(i==="VBODY"){t.at(-1)[i]="",r=!0;continue}t.at(-1)[i]=c,t.push(c)}continue}if(l==="END"){if(i==="VBODY"){r=!1;continue}t.pop();continue}const m=t.at(-1);if(!m)continue;if(r){m.VBODY+=a+`
`;continue}const[C,...f]=l.split(";"),p=i.split(";");m[C]={...f.length>0?{meta:f.reduce((c,y)=>{const[h,b]=y.split("=");return c[h]=b||!0,c},{})}:{},...p.length>1?{values:p}:{value:i}}}}return o}},I={parse(s){const n=s.split(/\r\n|\r|\n/),e={Date:new Date(0),Body:""};for(const o of n)if(!o.startsWith("CHARSET")){if(o.startsWith("Date:")){const t=o.slice(5).trim();e.Date=new Date(t);continue}else if(o==="")continue;e.Body+=o+`
`}return e}},M=768,D=window.matchMedia(`(width < ${M}px)`),L=()=>D.matches,N=document.getElementById("back"),S=document.querySelector("header .partner"),v=document.querySelector(".col"),E=document.querySelector("label .pick"),$=document.getElementById("file-picker"),g=document.getElementById("vmg-selector"),u=document.getElementById("contacts"),d=document.getElementById("messages"),R=async s=>(await Promise.all(s.map(async e=>{const o=await e.text();return V.parse(o)}))).flat().map(e=>{var a,l,i;const o=((a=e.FN)==null?void 0:a.value)||"",t=((l=e["SORT-STRING"])==null?void 0:l.value)||"",r=((i=e.TEL)==null?void 0:i.value)||"";return{formattedName:o,sortString:t,telNumber:r}}),k=s=>{new Set(s.map(e=>e.name)).forEach(e=>{const o=document.createElement("option");o.value=e,o.textContent=e,g.appendChild(o)}),g.hidden=!1},q=async s=>(await Promise.all(s.map(async e=>{const o=await e.text();return V.parse(o,"VMSG")}))).flat().map(e=>{var f,p,c,y,h,b,B,O,T;const o=((f=e["X-IRMC-TYPE"])==null?void 0:f.value)||"",t=((p=e["X-IRMC-BOX"])==null?void 0:p.value)||"",r=((y=(c=e.VCARD)==null?void 0:c.TEL)==null?void 0:y.value)||"",a=((B=(b=(h=e.VENV)==null?void 0:h.VCARD)==null?void 0:b.TEL)==null?void 0:B.value)||"",l=((T=(O=e.VENV)==null?void 0:O.VENV)==null?void 0:T.VBODY)||"",i=I.parse(l),m=i.Date,C=i.Body;return{type:o,box:t,from:r,to:a,date:m,text:C}}),A=()=>{S.textContent="",g.hidden=!0,[...g.querySelectorAll("option")].filter((n,e)=>e).forEach(n=>n.remove()),u.textContent="",d.textContent=""};let P=[];const j=E.textContent;$.addEventListener("change",async s=>{const n=s.target.files;if(A(),!(n!=null&&n.length)){E.textContent=j;return}const e=[...n].filter(t=>t.type==="text/vcard"||t.type==="text/x-vcard"||t.name.endsWith(".vcf")),o=[...n].filter(t=>t.name.endsWith(".vmg"));E.innerText=`${n.length}個のうち
${e.length+o.length}個の有効なファイル`,P=await R(e),k(o)});const W=async s=>{const n=s.sort((e,o)=>{const t=e.sortString||e.formattedName||e.telNumber,r=o.sortString||o.formattedName||o.telNumber;return t.localeCompare(r)}).map(e=>`<li>
      <button value="${e.telNumber}" data-name="${e.formattedName}">
        ${e.formattedName?`<div class="name">${e.formattedName}</div>`:""}
        <div class="tel">${e.telNumber}</div>
      </button>
    </li>
    `).join(`
`);u.innerHTML=n},X=async s=>{const n=s.filter(e=>e.type==="SMS").sort((e,o)=>e.date.getTime()-o.date.getTime()).map(e=>`<div class="message-box ${e.box.toLowerCase()}" data-box="${e.box}" data-from="${e.from}" data-to="${e.to}">
        <div class="text">${e.text.replace(/\n/g,"<br>")}</div>
        <div class="date">${e.date.toLocaleString()}</div>
      </div>
      `).join(`
`);d.innerHTML=n};let w=[];const Y=()=>new Set(w.map(s=>s.box==="INBOX"?s.from:s.to).filter(s=>s));g.addEventListener("change",async s=>{S.textContent="",u.textContent="",d.textContent="";const n=s.target.value;if(!n)return;const e=[...$.files].filter(r=>r.name===n);w=await q(e);const t=[...Y()].map(r=>P.find(a=>a.telNumber===r)||{formattedName:"",sortString:"",telNumber:r});await W(t)});const x=s=>{var e;const n=s===v?d:v;n.hidden=!0,s.hidden=!1,s===d?N.hidden=!1:(N.hidden=!0,S.textContent="",(e=u.querySelector(".active"))==null||e.classList.remove("active"),d.textContent="")};N.addEventListener("click",()=>{L()&&x(v)});u.addEventListener("click",async s=>{var t;const n=s.target.closest("button");if(!n)return;(t=u.querySelector(".active"))==null||t.classList.remove("active"),n.classList.add("active");const e=n.value;S.textContent=n.dataset.name||n.value;const o=w.filter(r=>(r.box==="INBOX"?r.from:r.to)===e);await X(o),L()&&x(d)});const F=()=>{if(L()){const s=u.querySelector(".active")!==null;x(s?d:v)}else N.hidden=!0,v.hidden=d.hidden=!1};F();D.addEventListener("change",F);
